name: Hydra Sync Protocol üêç (Native)

on:
  push:
    branches: [ main ]
    # Runs automatically whenever you update the Main account

jobs:
  distribute_traffic:
    runs-on: ubuntu-latest
    steps:
      # üëá FIX #1: Add 'persist-credentials: false' here
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
          persist-credentials: false 

      # =========================================================
      # 1Ô∏è‚É£ MIRROR 1 (otakuhero99-lang)
      # =========================================================
      - name: Sync to otakuhero99-lang
        run: |
          # üëá FIX #2: Force clear any stuck credentials
          git config --global --unset http.https://github.com/.extraheader || true
          
          # Add the remote with the Secret
          git remote add mirror1 https://otakuhero99-lang:${{ secrets.PAT_MIRROR_1 }}@github.com/otakuhero99-lang/anime-index.git

          # Push
          git push mirror1 main --force
          git remote remove mirror1

      # =========================================================
      # 2Ô∏è‚É£ MIRROR 2 (balwindar-wq)
      # =========================================================
      - name: Sync to balwindar-wq
        run: |
          # Force clear again just to be safe
          git config --global --unset http.https://github.com/.extraheader || true

          git remote add mirror2 https://balwindar-wq:${{ secrets.PAT_MIRROR_2 }}@github.com/balwindar-wq/anime-index.git
          git push mirror2 main --force
          git remote remove mirror2

      # =========================================================
      # 3Ô∏è‚É£ MIRROR 3 (otakverse01)
      # =========================================================
      - name: Sync to otakverse01
        run: |
          git config --global --unset http.https://github.com/.extraheader || true

          git remote add mirror3 https://otakverse01:${{ secrets.PAT_MIRROR_3 }}@github.com/otakverse01/anime-index.git
          git push mirror3 main --force
          git remote remove mirror3

      # =========================================================
      # 4Ô∏è‚É£ MIRROR 4 (verseotak01-dot)
      # =========================================================
      - name: Sync to verseotak01-dot
        run: |
          git config --global --unset http.https://github.com/.extraheader || true

          git remote add mirror4 https://verseotak01-dot:${{ secrets.PAT_MIRROR_4 }}@github.com/verseotak01-dot/anime-index.git
          git push mirror4 main --force
          git remote remove mirror4

      # =========================================================
      # 5Ô∏è‚É£ MIRROR 5 (OtaKuNexa - Wait, is this a mirror?)
      # =========================================================
      # ‚ö†Ô∏è NOTE: If OtaKuNexa is the MAIN account, you don't need this block.
      # If it is a DIFFERENT account, keep it.
      - name: Sync to OtaKuNexa
        run: |
          git config --global --unset http.https://github.com/.extraheader || true

          git remote add mirror5 https://OtaKuNexa:${{ secrets.PAT_MIRROR_5 }}@github.com/OtaKuNexa/anime-index.git
          git push mirror5 main --force
          git remote remove mirror5

      # =========================================================
      # 6Ô∏è‚É£ MIRROR 6 (hokaiwatch)
      # =========================================================
      - name: Sync to hokaiwatch
        run: |
          git config --global --unset http.https://github.com/.extraheader || true

          git remote add mirror6 https://hokaiwatch:${{ secrets.PAT_MIRROR_6 }}@github.com/hokaiwatch/anime-index.git
          git push mirror6 main --force
          git remote remove mirror6
